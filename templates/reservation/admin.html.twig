{% extends 'base.html.twig' %}
{% block breadcrumbs %}
    {% set breadcrumbs = [
        {'label': 'خانه', 'url': path('app_home')},
        {'label': 'داشبورد', 'url': path('app_panel')},
        {'label': 'رزرو ها'},
    ] %}
    {% set title = 'زمان های رزرو شده' %}
    
    {{ parent() }} {# This ensures the breadcrumbs are rendered in the base template #}
{% endblock %}
{% block title %}Reservation Index{% endblock %}

{% block body %}
<div class="content d-flex flex-column flex-column-fluid" id="kt_content">
    <div class="post d-flex flex-column-fluid" id="kt_post">
        <div id="kt_content_container" class="container-xxl">
            <div class="card card-flush">
                <div class="card-body pt-0">
                    <table class="table align-middle table-row-dashed fs-6 gy-5 border">
                        <thead class="border">
                            <tr class="text-start fw-bold fs-7 text-uppercase gs-0">
                                <th class="min-w-40px">ردیف</th>
                                <th class="text-start min-w-100px">پرسنل</th>
                                <th class="text-start min-w-100px">خدمات</th>
                                <th class="text-start min-w-100px">وقت رزرو</th>

                                {% if is_granted('ROLE_PERSONNEL') or is_granted('ROLE_ADMIN') %}
                                    <th class="text-start min-w-100px">مشتری</th>
                                {% endif %}

                                {% if is_granted('ROLE_ADMIN') %}
                                    <th class="text-start min-w-40px">زمان ساخت</th>
                                    <th class="text-start min-w-70px">زمان تغییر</th>
                                    <th class="text-start min-w-70px">وضعیت</th>
                                    <th class="text-start min-w-70px">عملیات</th>
                                {% endif %}
                            </tr>
                        </thead>

                        <tbody class="fw-semibold border">
                            {% for reserve in reservations %}
                                <tr>
                                    <td>{{ reserve.id }}</td>
                                    <td>{{ reserve.personal.fullname ?? 'No user' }}</td>
                                    <td>{{ reserve.Service.title }} | {{ reserve.ServiceChild.title }}</td>
                                    <td>{{ reserve.reservationDateTime }}</td>

                                    {% if is_granted('ROLE_PERSONNEL') or is_granted('ROLE_ADMIN') %}
                                        <td>{{ reserve.user.id ?? 'No user' }}</td>
                                    {% endif %}

                                    {% if is_granted('ROLE_ADMIN') %}
                                        <td>{{ reserve.cdate|localizeddatetr('full', 'none', 'fa_IR@calendar=persian', 'Asia/Tehran', 'yyyy/MM/dd') }} ساعت {{ reserve.cdate|localizeddatetr('full', 'none', 'fa_IR@calendar=persian', 'Asia/Tehran', 'HH:mm') }}</td>
                                        <td>{{ reserve.udate|localizeddatetr('full', 'none', 'fa_IR@calendar=persian', 'Asia/Tehran', 'yyyy/MM/dd') }} ساعت {{ reserve.udate|localizeddatetr('full', 'none', 'fa_IR@calendar=persian', 'Asia/Tehran', 'HH:mm') }}</td>
                                        <td>
                                            <span class="badge {{ reserve.published ? 'badge-light-success' : 'badge-danger' }}">
                                                {{ reserve.published ? 'برسی شد' : 'در انتظار' }}
                                            </span>
                                        </td>
                                        <td>
                                            <button id="removeButton-{{ reserve.id }}" class="btn badge badge-dark sendData" data-table="reserve" data-field="remove" data-value="1" data-id="{{ reserve.id }}">حذف کردن</button>
                                            <button id="publishButton-{{ reserve.id }}" class="btn badge {{ reserve.published ? 'badge-danger' : 'badge-light-success' }} sendData" data-table="reserve" data-field="published" data-value="{{ reserve.published ? '0' : '1' }}" data-id="{{ reserve.id }}">
                                                {{ reserve.published ? 'کنارگذاشتن' : 'برسی شد' }}
                                            </button>
                                        </td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
